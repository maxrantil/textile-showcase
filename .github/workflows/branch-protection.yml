name: Branch Protection

on:
  push:
    branches:
      - master

jobs:
  block-direct-push:
    name: Block Direct Push to Master
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && github.ref == 'refs/heads/master'
    steps:
      - name: Check if push is from PR merge
        run: |
          # Allow GitHub's automatic PR merge commits
          if [[ "${{ github.event.head_commit.message }}" =~ ^Merge\ pull\ request ]]; then
            echo "✅ PR merge detected - allowing"
            exit 0
          fi

          echo "❌ ERROR: Direct pushes to master are not allowed!"
          echo "Please create a feature branch and submit a PR:"
          echo ""
          echo "  git checkout -b feat/your-feature-name"
          echo "  git push origin feat/your-feature-name"
          echo "  gh pr create"
          exit 1
